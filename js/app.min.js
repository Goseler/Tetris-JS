document.addEventListener("DOMContentLoaded",()=>{function e(){let e=document.querySelector(".grid");for(let t=0;t<O;t++){let t=document.createElement("div");e.appendChild(t)}for(let t=0;t<T;t++){let t=document.createElement("div");t.setAttribute("class","taken"),e.appendChild(t)}let t=Array.from(document.querySelectorAll(".mini-grid")),n=t[0];for(let e=0;e<16;e++){let e=document.createElement("div");n.appendChild(e)}n=t[1];for(let e=0;e<16;e++){let e=document.createElement("div");n.appendChild(e)}n=t[2];for(let e=0;e<16;e++){let e=document.createElement("div");n.appendChild(e)}return e}function t(){he.forEach(e=>{re[ce+e].classList.add("tetromino"),re[ce+e].style.backgroundImage=U[fe]})}function n(){he.forEach(e=>{re[ce+e].classList.remove("tetromino"),re[ce+e].style.backgroundImage="none"})}function o(e){37===e.keyCode?l():38===e.keyCode?u():39===e.keyCode?c():40===e.keyCode&&r()}function r(){n(),ce+=T,t(),a()}function a(){he.some(e=>re[ce+e+T].classList.contains("taken"))&&(he.forEach(e=>re[ce+e].classList.add("taken")),ce=4,se=0,fe=ge[0],ge[0]=ge[1],ge[1]=ge[2],ge[2]=Math.floor(Math.random()*Q.length),he=Q[fe][se],m(),k(),L())}function l(){n();const e=he.some(e=>(ce+e)%T==0);e||(ce-=1),he.some(e=>re[ce+e].classList.contains("taken"))&&(ce+=1),t()}function c(){n();const e=he.some(e=>(ce+e)%T==T-1);e||(ce+=1),he.some(e=>re[ce+e].classList.contains("taken"))&&(ce-=1),t()}function s(){return he.some(e=>(ce+e+1)%T==0)}function i(){return he.some(e=>(ce+e)%T==0)}function d(e){e=e||ce,(e+1)%T<4?s()&&(ce+=1,d(e)):e%T>5&&i()&&(ce-=1,d(e))}function u(){n(),se++,se===he.length&&(se=0),he=Q[fe][se],d(),t()}function m(){g();for(let e=0;e<ge.length;e++)R[ge[e]].forEach(t=>{B[N+t].classList.add("tetromino"),B[N+t].style.backgroundImage=U[ge[e]]}),N+=16;N=0}function g(){B.forEach(e=>{e.classList.remove("tetromino"),e.style.backgroundImage="none"})}function f(){ae?(clearInterval(ae),ae=null,document.removeEventListener("keyup",o),W.innerHTML='<img src="./images/controls/play.png" alt="play/pause">'):(t(),ae=oe.checked?setInterval(r,1e3/ie):setInterval(r,1e3/I()),m(),document.addEventListener("keyup",o),W.innerHTML='<img src="./images/controls/pause.png" alt="play/pause">'),this.blur()}function h(){for(let e=0;e<199;e+=T){const t=[e,e+1,e+2,e+3,e+4,e+5,e+6,e+7,e+8,e+9];t.forEach(e=>{re[e].classList.remove("taken"),re[e].classList.remove("tetromino"),re[e].style.backgroundColor="",re[e].style.backgroundImage="none"}),re.forEach(e=>x.appendChild(e))}}function p(){ae&&(clearInterval(ae),ae=null),W.innerHTML='<img src="./images/controls/play.png" alt="play/pause">',_.forEach(e=>{e.checked=!1}),te.checked=!0,le=0,V.innerHTML=le,fe=Math.floor(Math.random()*Q.length),ge[0]=Math.floor(Math.random()*Q.length),ge[1]=Math.floor(Math.random()*Q.length),ge[2]=Math.floor(Math.random()*Q.length),he=Q[fe][se],ce=4,se=0,g(),h(),W.disabled=!1,document.addEventListener("keyup",o),$.pause(),this.blur()}function k(){let e=0;for(let t=0;t<199;t+=T){const n=[t,t+1,t+2,t+3,t+4,t+5,t+6,t+7,t+8,t+9];if(n.every(e=>re[e].classList.contains("taken"))){n.forEach(e=>{re[e].classList.remove("taken"),re[e].classList.remove("tetromino"),re[e].style.backgroundColor="",re[e].style.backgroundImage="none"});const o=re.splice(t,T);re=o.concat(re),re.forEach(e=>x.appendChild(e)),e++}}oe.checked?(le+=100*e,4===e&&(le+=400),v()):(le+=100*e*I(),4===e&&(le+=400*I())),V.innerHTML=le,t()}function v(){le<=ue&&le>0&&(clearInterval(ae),ae=setInterval(r,1e3/(ie+de*Math.floor(le/me))))}function y(){null===localStorage.getItem("bestScore")&&localStorage.setItem("bestScore",0)}function L(){if(he.some(e=>re[ce+e].classList.contains("taken"))){let e=localStorage.getItem("bestScore");e<le?(alert("Congratulations! New best: "+le+" pts."),localStorage.setItem("bestScore",le)):alert("Game over! Your score: "+le+" pts."),le=0,clearInterval(ae),document.removeEventListener("keyup",o),W.disabled=!0,$.pause()}}function b(){ae&&(f(),E()),this.blur(),pe.show()}function E(){!0===$.paused?$.play():$.pause()}function M(){'<img src="./images/controls/mute.png" alt="volume/mute">'===Z.innerHTML?(Z.innerHTML='<img src="./images/controls/volume.png" alt="volume/mute">',$.muted=!1):(Z.innerHTML='<img src="./images/controls/mute.png" alt="volume/mute">',$.muted=!0),this.blur()}function S(){ae&&(clearInterval(ae),ae=setInterval(r,1e3/I())),this.blur()}function I(){for(let e=0;e<_.length;e++)if(_[e].checked)return _[e].value}function C(){oe.checked?A():H()}function q(){oe.disabled=!0}function w(){oe.disabled=!1}function A(){_.forEach(e=>{e.disabled=!0})}function H(){_.forEach(e=>{e.disabled=!1})}const T=10,D=20,O=T*D,x=e(),B=Array.from(document.querySelectorAll(".mini-grid div")),G=4;let N=0;const R=[[1,G+1,2*G+1,2],[1,G+1,2*G+1,0],[2*G,2*G+1,G+1,G+2],[G,2*G+1,G+1,2*G+2],[1,G,G+1,G+2],[0,1,G,G+1],[1,G+1,2*G+1,3*G+1]],U=["url(./images/game/tetrominoes/block-blue.png)","url(./images/game/tetrominoes/block-orange.png)","url(./images/game/tetrominoes/block-green.png)","url(./images/game/tetrominoes/block-red.png)","url(./images/game/tetrominoes/block-purple.png)","url(./images/game/tetrominoes/block-lime.png)","url(./images/game/tetrominoes/block-aquamarine.png)"],Y=[[1,T+1,2*T+1,2],[T,T+1,T+2,2*T+2],[1,T+1,2*T+1,2*T],[T,2*T,2*T+1,2*T+2]],j=[[1,T+1,2*T+1,0],[T,T+1,T+2,2],[1,T+1,2*T+1,2*T+2],[T,T+1,T+2,2*T]],z=[[2*T,2*T+1,T+1,T+2],[0,T,T+1,2*T+1],[2*T,2*T+1,T+1,T+2],[0,T,T+1,2*T+1]],F=[[T,2*T+1,T+1,2*T+2],[1,T,T+1,2*T],[T,2*T+1,T+1,2*T+2],[1,T,T+1,2*T]],J=[[T,1,T+1,T+2],[1,T+1,2*T+1,T+2],[T,T+1,2*T+1,T+2],[T,1,T+1,2*T+1]],K=[[0,1,T,T+1],[0,1,T,T+1],[0,1,T,T+1],[0,1,T,T+1]],P=[[1,T+1,2*T+1,3*T+1],[T,T+1,T+2,T+3],[1,T+1,2*T+1,3*T+1],[T,T+1,T+2,T+3]],Q=[Y,j,z,F,J,K,P],V=document.querySelector("#score"),W=document.querySelector("#start-btn"),X=document.querySelector("#reset-btn"),Z=document.querySelector("#mute-btn"),$=document.getElementById("player"),_=Array.from(document.querySelectorAll(".btn-group-vertical input")),ee=document.querySelector("#rules-modal-btn"),te=document.querySelector("#default-speed-btn"),ne=document.getElementById("rules-modal"),oe=document.querySelector("#switch-mode");let re=Array.from(document.querySelectorAll(".grid div")),ae=null,le=0,ce=4,se=0;const ie=.5,de=.25,ue=2e4,me=2e3;let ge=[];ge.push(Math.floor(Math.random()*Q.length)),ge.push(Math.floor(Math.random()*Q.length)),ge.push(Math.floor(Math.random()*Q.length));let fe=Math.floor(Math.random()*Q.length),he=Q[fe][se],pe=new bootstrap.Modal(ne,{keyboard:!0});W.addEventListener("click",f),W.addEventListener("click",E),W.addEventListener("click",q),W.addEventListener("click",A),document.addEventListener("keyup",function(e){ne.classList.contains("show")||-1==["Space"].indexOf(e.code)||W.click()}),X.addEventListener("click",p),X.addEventListener("click",w),X.addEventListener("click",H),X.addEventListener("click",C),ee.addEventListener("click",b),_.forEach(e=>{e.addEventListener("click",S)}),Z.addEventListener("click",M),oe.addEventListener("change",C),window.addEventListener("keydown",function(e){["Space","ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].indexOf(e.code)>-1&&e.preventDefault()},!1),y(),b()});